# 线程
> 进程是操作系统`分配资源`的最小单位
> 线程是操作系统`调度执行`的最小单位

## 创建线程
### Thread模块
```python
from threading import Thread
import time


def test():
    for i in range(5):
        print('洗碗')
        time.sleep(0.1)


t = Thread(target=test)

t.start()

for i in range(10):
    print('看电视')
    time.sleep(0.1)

t.join()

# >>> 洗碗看电视
# >>>
# >>> 洗碗
# >>> 看电视
# >>> 洗碗
# >>> 看电视
# >>> 洗碗
# >>> 看电视
# >>> 洗碗
# >>> 看电视
# >>> 看电视
# >>> 看电视
# >>> 看电视
# >>> 看电视
# >>> 看电视
```
### 继承Thread类创建线程
```python
from threading import Thread
import time


class test(Thread):
    def run(self):
        for i in range(5):
            print('洗碗')
            time.sleep(0.1)


t = test()

t.start()

for i in range(10):
    print('看电视')
    time.sleep(0.1)

t.join()

# >>> 洗碗看电视
# >>>
# >>> 洗碗
# >>> 看电视
# >>> 洗碗
# >>> 看电视
# >>> 洗碗
# >>> 看电视
# >>> 洗碗
# >>> 看电视
# >>> 看电视
# >>> 看电视
# >>> 看电视
# >>> 看电视
# >>> 看电视
```
### enumerate()查看线程信息
```python
from threading import Thread, enumerate
import time


class test(Thread):
    def run(self):
        for i in range(5):
            print('洗碗')
            time.sleep(0.1)


t = test()

t.start()

# enumerate() 查看线程信息
print(enumerate()) #  >>> [<_MainThread(MainThread, started 4586436032)>, <test(Thread-1, started 123145409781760)>]

for i in range(10):
    print('看电视')
    time.sleep(0.1)

t.join()

# >>> 洗碗看电视
# >>>
# >>> 洗碗
# >>> 看电视
# >>> 洗碗
# >>> 看电视
# >>> 洗碗
# >>> 看电视
# >>> 洗碗
# >>> 看电视
# >>> 看电视
# >>> 看电视
# >>> 看电视
# >>> 看电视
# >>> 看电视
```
### 多进程修改全局变量
```python
from threading import Thread, enumerate
import time

num = 10


def test_1():
    global num
    print('线程1 num={}'.format(num))
    num += 1
    print('线程1 num={}'.format(num))


def test_2():
    global num
    print('线程2 num={}'.format(num))
    num += 1
    print('线程2 num={}'.format(num))


t1 = Thread(target=test_1)
t2 = Thread(target=test_2)

t1.start()
t1.join()

t2.start()
t2.join()

# >>> 线程1 num=10
# >>> 线程1 num=11
# >>> 线程2 num=11
# >>> 线程2 num=12
```

### 多线程-竞争问题
```python
from threading import Thread, enumerate
import time

num = 10


def test_1():
    for i in range(1000000):
        global num
        num += 1


def test_2():
    for i in range(1000000):
        global num
        num += 1


t1 = Thread(target=test_1)
t2 = Thread(target=test_2)

t1.start()
t2.start()

t1.join()
t2.join()

print(num)

# >>>  1330024
```

### 互斥所-解决线程竞争问题
```python
from threading import Thread, enumerate, Lock
import time

num = 10

mutex = Lock()
def test_1():
    for i in range(1000000):
        global num
        mutex.acquire()
        num += 1
        mutex.release()


def test_2():
    for i in range(1000000):
        global num
        mutex.acquire()
        num += 1
        mutex.release()


t1 = Thread(target=test_1)
t2 = Thread(target=test_2)

t1.start()
t2.start()

t1.join()
t2.join()

print(num)

# >>>  2000010
```
### 非阻塞方式使用-互斥所
```python
from threading import Thread, enumerate, Lock
import time

num = 10

mutex = Lock()
def test_1():
    for i in range(1000000):
        while 1:
            global num
            ret = mutex.acquire(False)
            if ret:
                num += 1
                mutex.release()
                break
            else:
                print('唱歌')


def test_2():
    for i in range(1000000):
        while 1:
            global num
            ret = mutex.acquire(False)
            if ret:
                num += 1
                mutex.release()
                break
            else:
                print('跳舞')

t1 = Thread(target=test_1)
t2 = Thread(target=test_2)

t1.start()
t2.start()

t1.join()
t2.join()

print(num)

# >>> 唱歌
# >>> 唱歌
# >>> 唱歌
# >>> 唱歌
# >>> 唱歌
# >>> 跳舞
# >>> 唱歌
# >>> 跳舞
# >>> 跳舞
# >>> 跳舞
# >>> 跳舞
# >>> 跳舞
# >>> 跳舞
# >>> 唱歌
# >>> 唱歌
# >>> 唱歌
# >>> 唱歌
# >>> 唱歌
# >>> 唱歌
# >>> 唱歌
# >>> 2000010
```
